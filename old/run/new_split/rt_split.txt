enable
configure terminal
!
hostname RT1-St-777
!
service password-encryption
service dhcp
!
username cisco privilege 15 secret classclass
security passwords min-length 10
!
ip domain name isepacademy.ccna.itn.com
no ip domain-lookup
!
login block-for 300 attempts 3 within 120
!
ip ssh version 2
!
ip host zagreb-pula 10.0.0.1 
ip host pula-zagreb 10.0.0.2 
ip host zagreb-split 10.0.0.5  
ip host pula-split 10.0.0.9 
ip host split-zagreb 10.0.0.6
ip host split-pula 10.0.0.10
ip host sw1 172.20.14.42
ip host sw1-st 172.20.14.42
ip host rt1-st 172.20.14.41
ip host rt1-zg 172.20.7.97
ip host mls1-zg 172.20.7.4
ip host mls2-zg 172.20.7.5
ip host sw1-zg 172.20.7.2
ip host sw2-zg 172.20.7.3
ip host srv-dhcp 172.20.7.36
ip host rt1-pl 172.20.11.105
ip host sw1-pl 172.20.11.106
ip host Lo0 172.20.13.129 
ip host Lo1 172.20.13.193 
ip host Lo2 172.20.13.1
ip host ap 172.20.14.34 
ip host pc-d 172.20.12.2
!
! --- DHCP POOLS ---
ip dhcp excluded-address 172.20.12.1 172.20.12.5
ip dhcp excluded-address 172.20.12.129 172.20.12.133
ip dhcp excluded-address 172.20.14.1 172.20.14.5
!
ip dhcp pool VLAN30-STAFF
 network 172.20.12.0 255.255.255.128
 default-router 172.20.12.1
 dns-server 8.8.8.8
 domain-name isepacademy.ccna.itn.com
!
ip dhcp pool VLAN50-WIRELESS-ZG
 network 172.20.12.128 255.255.254.128   
 default-router 172.20.12.129
 dns-server 8.8.8.8
 domain-name isepacademy.ccna.itn.com
!
ip dhcp pool VLAN60-GUESTS
 network 172.20.14.0 255.255.255.224
 default-router 172.20.14.1
 dns-server 8.8.8.8
 domain-name isepacademy.ccna.itn.com
!
ip dhcp pool VOIP-SPLIT
 network 172.20.13.192 255.255.255.192
 default-router 172.20.13.193
 option 150 ip 172.20.13.193
!
! --- VPN / IPSEC CONFIGS ---
crypto isakmp policy 100
 encr aes 128
 hash sha
 authentication pre-share
 group 5
!
crypto isakmp key z4gr3b$pl1t address 172.16.201.54
crypto isakmp key Pvl4$pl1t address 172.16.201.65
!
crypto ipsec transform-set TSET esp-aes 128 esp-sha-hmac
 mode tunnel
!
crypto map CROATIA 10 ipsec-isakmp
 set peer 172.16.201.54
 set transform-set TSET
 match address 101
!
crypto map CROATIA 20 ipsec-isakmp
 set peer 172.16.201.65
 set transform-set TSET
 match address 102
!
! --- INTERFACES ---
interface Loopback0  
 description CONNECTION TO MULTIMEDIA  
 ip address 172.20.13.129 255.255.255.192  
 ip nat inside
!  
interface Loopback1  
 description CONNECTION TO DESIGN
 no ip address
 shut
!  
interface Loopback2  
 description CONNECTION TO COMMUNICATION  
 ip address 172.20.13.1 255.255.255.128  
 ip nat inside
!
interface Tunnel0
 description Tunnel SPLIT-ZAGREB
 ip address 10.0.0.6 255.255.255.252
 tunnel source GigabitEthernet0/0
 tunnel destination 172.16.201.54
 no shutdown
!
interface Tunnel1
 description Tunnel SPLIT-PULA
 ip address 10.0.0.10 255.255.255.252
 tunnel source GigabitEthernet0/0
 tunnel destination 172.16.201.65
 no shutdown
!  
interface GigabitEthernet0/0  
 ip address dhcp
 duplex auto
 speed auto  
 ip nat outside 
 crypto map CROATIA
 no shutdown
!  
interface GigabitEthernet0/1  
 no ip address  
 duplex auto  
 speed auto
 no shutdown  
!
interface GigabitEthernet0/1.5
 description VLAN 5 - AP
 encapsulation dot1Q 5
 ip address 172.20.14.33 255.255.255.248
 ip nat inside
!
interface GigabitEthernet0/1.6
 description VLAN 6 - MANAGEMENT
 encapsulation dot1Q 6
 ip address 172.20.14.41 255.255.255.248
 ip nat inside
!
interface GigabitEthernet0/1.7
 description NATIVE VLAN FIX
 encapsulation dot1Q 7 native
 no ip address
!
interface GigabitEthernet0/1.30
 description VLAN 30 - STAFF
 encapsulation dot1Q 30
 ip address 172.20.12.1 255.255.255.128
 ip nat inside
!
interface GigabitEthernet0/1.40
 description VLAN 40 - VOIP
 encapsulation dot1Q 40
 ip address 172.20.13.193 255.255.255.192
 ip nat inside
 ip access-group VOIP-NO-INTERNET in
!
interface GigabitEthernet0/1.50
 description VLAN 50 - WIRELESS
 encapsulation dot1Q 50
 ip address 172.20.12.129 255.255.255.128
 ip nat inside
!
interface GigabitEthernet0/1.60
 description VLAN 60 - GUESTS
 encapsulation dot1Q 60
 ip address 172.20.14.1 255.255.255.224
 ip nat inside
!  
interface GigabitEthernet0/2  
 no ip address  
 duplex auto  
 speed auto  
 shutdown
!
! --- ROUTING & NAT ---
ip route 0.0.0.0 0.0.0.0 dhcp
!
router ospf 100
 router-id 3.3.3.3
 passive-interface default
 no passive-interface GigabitEthernet0/1
 no passive-interface Tunnel0
 network 172.20.13.128 0.0.0.63 area 0
 network 172.20.13.192 0.0.0.63 area 0
 network 172.20.13.0 0.0.0.127 area 0
 network 172.20.14.40 0.0.0.3 area 0
 network 10.0.0.4 0.0.0.3 area 0
 network 10.0.0.8 0.0.0.3 area 0
 network 172.20.12.0 0.0.0.255 area 0
 network 172.20.14.0 0.0.0.255 area 0
!
ip access-list extended NAT-ACL
 deny ip 172.20.0.0 0.0.255.255 172.16.201.0 0.0.0.255
 permit ip 172.20.0.0 0.0.255.255 any
 exit
! Aplicar a nova ACL no NAT
no ip nat inside source list 1 interface GigabitEthernet0/0 overload
ip nat inside source list NAT-ACL interface GigabitEthernet0/0 overload
!
! --- ACLs ---
access-list 1 permit 172.20.0.0 0.0.255.255
!
ip access-list extended 101
 permit gre host 172.16.201.57 host 172.16.201.54
!
ip access-list extended 102
 permit gre host 172.16.201.57 host 172.16.201.65
!
ip access-list extended VOIP-NO-INTERNET
 permit ip 172.20.13.192 0.0.0.63 172.20.0.0 0.0.255.255
 permit ip 172.20.13.192 0.0.0.63 10.0.0.0 0.255.255.255
 deny ip any any
!
ip access-list extended GUEST-ONLY-INTERNET
 deny ip 172.20.14.0 0.0.0.31 172.20.0.0 0.0.255.255
 permit ip any any
!
ip access-list standard ACL-SNMP
 permit host 172.20.7.35
 deny any
!

ip access-list standard SSH-ACCESS
 permit 172.20.12.0 0.0.0.127
 permit 172.20.4.0 0.0.0.255
 permit 172.20.14.40 0.0.0.7
 deny any
 exit
line vty 0 15
 access-class SSH-ACCESS in
 exit
 

! --- TELEPHONY ---
dial-peer voice 2000 voip
 destination-pattern 2...
 session target ipv4:10.0.0.5 
!
dial-peer voice 4000 voip
 destination-pattern 4...
 session target ipv4:10.0.0.9 
!
telephony-service
 max-ephones 5 
 max-dn 10 
 ip source-address 172.20.13.193 port 2000 
 system message SPLIT-VOICE 
 create cnf-files 
!
ephone-dn 1
 number 5001 
!
ephone-dn 2
 number 5002 
!
! --- LOGGING, SNMP & NTP ---
logging host 172.20.7.35
logging trap informational
!
snmp-server community cisco RO ACL-SNMP
snmp-server enable traps
snmp-server host 172.20.7.35 version 2c cisco
!
ntp server 172.20.7.97 
!
! --- LINES & BANNERS ---
banner motd %
######################################################################
#                                                                    #
#                       Private Property                             #
#           Unnauthorized access will not be tolerated               #
#                          RT1-St-777                                #
#                                                                    #
######################################################################
%
!
line con 0
 password classclass
 login local
line aux 0
 password classclass
 login
line vty 0 15
 exec-timeout 0 30
 privilege level 15
 password classclass
 login local
 transport input ssh
!
! --- GERAR CHAVE RSA (SSH) ---
crypto key generate rsa general-keys modulus 2048
!
end
write memory