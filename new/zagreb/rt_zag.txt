enable
conf t
no ip domain-lookup
hostname RT1-Zg-777
ip domain-name isepacademy.ccna.itn.com
service password-encryption
security passwords min-length 10
enable secret classclass
username cisco privilege 15 secret classclass
crypto key generate rsa general-keys modulus 1024
line vty 0 15
login local
transport input ssh
exec-timeout 0 30
exit
login block-for 300 attempts 3 within 120
banner motd %
######################################################################
#                                                                    #
#                        Private Property                            #
#            Unnauthorized access will not be tolerated              #
#                           RT1-Zg-777                               #
#                                                                    #
######################################################################
%

-----REVER----
ip host RT1-Zg 172.20.7.1
ip host SW1-Zg 172.20.7.7
ip host SW2-Zg 172.20.7.8
ip host MLS1-Zg 172.20.7.4
ip host MLS2-Zg 172.20.7.5
ip host RTVi-Zg 172.20.7.62
ip host WLC1-Zg 172.20.7.6
ip host AP1-Zg 172.20.7.131
ip host PCA 172.20.5.3
ip host PCB 172.20.4.3
ip host DHCP-SRV 172.20.7.67
ip host RT1-Pl 172.20.11.113
ip host SW1-Pl 172.20.11.114
ip host AP1-Pl 172.20.11.98
ip host PCC 172.20.10.130
ip host RT1-St 172.20.13.241
ip host SW1-St 172.20.13.242
ip host AP1-St 172.20.13.226
ip host PCD 172.20.12.2

ipv6 unicast-routing
int g0/0
 ipv6 enable
 ip add 172.20.7.193 255.255.255.252
 ipv6 add fe80::1 link-local
 description RT1-Zg to MLS1-Zg
 no shut
int g0/1
 ipv6 enable
 ip add 172.20.7.197 255.255.255.252
 ipv6 add fe80::2 link-local
 description RT1-Zg to MLS2-Zg
 no shut
int g0/2
 description Internet Connection
 ipv6 enable
 ip address dhcp
 no shut

----------

configure terminal
crypto isakmp policy 100
encr aes 128
hash sha
authentication pre-share
group 5
exit
! Chaves com os vizinhos (Pula e Split)
crypto isakmp key z4gr3bPvl4 address 172.16.201.77
crypto isakmp key z4gr3b$pl1t address 172.16.201.79
crypto ipsec transform-set TSET esp-aes 128 esp-sha-hmac
mode tunnel
exit
! ACL para Pula (Limpar antiga e criar nova)
no ip access-list extended GRE_TO_PULA
ip access-list extended GRE_TO_PULA
permit gre host 172.16.201.78 host 172.16.201.77
deny ip any any
exit
! ACL para Split (Limpar antiga e criar nova)
no ip access-list extended GRE_TO_SPLIT
ip access-list extended GRE_TO_SPLIT
permit gre host 172.16.201.78 host 172.16.201.79
deny ip any any
exit
! Crypto Map
crypto map CROATIA 10 ipsec-isakmp
set peer 172.16.201.77
set transform-set TSET
match address GRE_TO_PULA
exit
crypto map CROATIA 20 ipsec-isakmp
set peer 172.16.201.79
set transform-set TSET
match address GRE_TO_SPLIT
exit
! Aplicar na Interface WAN
interface g0/2
crypto map CROATIA
exit
! TÃºneis
interface Tunnel0
description GRE Tunnel to Pula
ip address 10.0.0.1 255.255.255.252
tunnel source g0/2
tunnel destination 172.16.201.77
tunnel mode gre ip
no shut
exit
interface Tunnel1
description GRE Tunnel to Split
ip address 10.0.0.5 255.255.255.252
tunnel source g0/2
tunnel destination 172.16.201.79
tunnel mode gre ip
no shut
exit

access-list 1 permit 172.20.0.0 0.0.255.255
ip nat inside source list 1 interface Gig0/2 overload
interface Gig0/0
ip nat inside
exit
interface Gig0/1
ip nat inside
exit
interface Gig0/2
ip nat outside
exit
! Static NAT
ip nat inside source static tcp 172.20.7.67 80 interface Gig0/2 80
ip nat inside source static tcp 172.20.7.67 443 interface Gig0/2 443
ip nat inside source static tcp 172.20.7.67 22 interface Gig0/2 22

ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/2
router ospf 100
router-id 1.1.1.1
default-information originate
network 10.0.0.1 0.0.0.0 area 0
network 10.0.0.5 0.0.0.0 area 0
network 172.20.7.193 0.0.0.0 area 0
network 172.20.7.197 0.0.0.0 area 0
exit

ip domain-lookup
ip name-server 8.8.8.8 1.1.1.1
ntp server pool.ntp.org
ntp master 4
ntp update-calendar

logging host 172.20.7.70
logging trap informational
logging on

ip access-list standard ACL_SNMP
remark Permit SNMP
permit ip 172.20.7.70
exit

ip access-list standard ACL_SSH
remark Allow ZG Admin and Staff
permit 172.20.5.0 0.0.0.255
permit 172.20.4.0 0.0.0.255
remark Allow PL Admin and Staff
permit 172.20.9.0 0.0.0.255
permit 172.20.10.0 0.0.0.255
remark Allow ST Admin and Staff
permit 172.20.12.0 0.0.0.255
permit 172.20.13.0 0.0.0.255
exit
snmp-server community cisco ro ACL_SNMP
line vty 0 15
access-class ACL_SSH in
exit



