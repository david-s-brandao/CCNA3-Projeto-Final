! mls2-zg FINAL
enable
conf t

! --- CONFIGURAÇÕES BÁSICAS ---
hostname MLS2-Zg-777
service password-encryption
username cisco privilege 15 secret classclass
ip routing
no ip domain-lookup
ip domain name isepacademy.ccna.itn.com
crypto key generate rsa general-keys modulus 2048
ip ssh version 2
line vty 0 15
 transport input ssh
 login local
exit

! --- NTP (Parte 8) ---
ntp server 172.20.7.101

! --- INTERFACES ETHERCHANNEL ---
! Primeiro limpamos para garantir que não há lixo
default interface range GigabitEthernet1/0/2-3
default interface Port-channel1

! Configurar Port-channel
interface Port-channel1  
 description ETHERCHANNEL BETWEEN MLSs
 switchport trunk native vlan 7  
 switchport trunk allowed vlan 1-98,100-4094  
 switchport mode trunk 
 switchport nonegotiate
 no shut 

! Configurar Membros Físicos
interface range GigabitEthernet1/0/2-3
 description ETHERCHANNEL PORTs
 switchport trunk native vlan 7
 switchport trunk allowed vlan 1-98,100-4094
 switchport mode trunk
 switchport nonegotiate
 channel-group 1 mode on
 no shutdown

! --- UPLINK AO ROUTER ---
interface GigabitEthernet1/0/1  
 description CONNECTION TO RT1-ZG 
 no switchport  
 ip address 172.20.7.102 255.255.255.252 
 no shut  

! --- DOWNLINKS AOS SWITCHES ---
interface GigabitEthernet1/0/4  
 description CONNECTION TO SW2-ZG  
 switchport trunk native vlan 7  
 switchport trunk allowed vlan 1-98,100-4094  
 switchport mode trunk  
 switchport nonegotiate  
 no shut

interface GigabitEthernet1/0/5  
 description CONNECTION TO SW1-ZG  
 switchport trunk native vlan 7  
 switchport trunk allowed vlan 1-98,100-4094  
 switchport mode trunk  
 switchport nonegotiate  
 no shut

! --- PORTAS OFF ---
interface range g1/0/6-24, g1/1/1-4
 description PORTs OFF
 switchport access vlan 99
 switchport mode access
 shutdown

! --- VLANs ---
vlan 5,6,7,10,20,30,40,50,60,99
exit
vlan 5
 name APs
vlan 6
 name MANAGEMENT
vlan 7
 name NATIVE
vlan 10
 name SERVERS
vlan 20
 name ADMINISTRATION
vlan 30
 name STAFF
vlan 40
 name VOIP
vlan 50
 name WIRELESS
vlan 60
 name GUESTS
vlan 99
 name BLACKHOLE
exit

! --- SPANNING TREE ---
spanning-tree mode rapid-pvst
spanning-tree portfast bpduguard default
spanning-tree vlan 40,50,60 priority 24576
spanning-tree vlan 5,6,10,20,30 priority 28672

! --- SEGURANÇA L2 ---
ip dhcp snooping vlan 10,20,30
ip arp inspection vlan 10,20,30
! Confiar nos Uplinks/Trunks
interface range g1/0/1-5, Po1
 ip dhcp snooping trust
 ip arp inspection trust
exit

! --- SVIs ---
interface Vlan1  
 no ip address  
 shutdown  
  
interface Vlan5  
 description VLAN AP
 ip address 172.20.7.67 255.255.255.224  
 standby 5 ip 172.20.7.65  
 standby 5 timers 1 3  
 standby 5 preempt  
 no shut
  
interface Vlan6  
 description VLAN MANAGEMENT 
 ip address 172.20.7.5 255.255.255.224  
 standby 6 ip 172.20.7.1  
 standby 6 timers 1 3  
 standby 6 preempt
 no shut  
  
interface Vlan10  
 description VLAN SERVERS
 ip address 172.20.7.35 255.255.255.224  
 standby 10 ip 172.20.7.33  
 standby 10 timers 1 3  
 standby 10 preempt  
 no shut
  
interface Vlan20  
 description VLAN ADM
 ip address 172.20.4.3 255.255.255.0  
 standby 20 ip 172.20.4.1  
 standby 20 timers 1 3  
 standby 20 preempt  
 ip helper-address 172.20.7.36
 no shut
  
interface Vlan30  
 description VLAN STAFF
 ip address 172.20.5.3 255.255.255.0  
 standby 30 ip 172.20.5.1  
 standby 30 timers 1 3  
 standby 30 preempt  
 ip helper-address 172.20.7.36
 no shut
  
interface Vlan40  
 description VLAN VOIP
 ip address 172.20.0.3 255.255.254.0  
 standby 40 ip 172.20.0.1  
 standby 40 timers 1 3  
 standby 40 priority 110
 standby 40 preempt  
 ip helper-address 172.20.7.36
 no shut
  
interface Vlan50 
 description VLAN WIRELESS
 ip address 172.20.2.3 255.255.254.0  
 standby 50 ip 172.20.2.1  
 standby 50 timers 1 3  
 standby 50 priority 110
 standby 50 preempt  
 ip helper-address 172.20.7.36
 no shut
  
interface Vlan60  
 description VLAN GUESTS
 ip address 172.20.6.3 255.255.255.0  
 standby 60 ip 172.20.6.1  
 standby 60 timers 1 3  
 standby 60 priority 110
 standby 60 preempt
 ip helper-address 172.20.7.36
 no shut

! --- OSPF---

router ospf 100
 router-id 3.3.3.3
 network 172.20.0.0 0.0.255.255 area 0
 passive-interface default
 no passive-interface GigabitEthernet1/0/1
 no passive-interface Port-channel1
exit

! --- LOGGING E SNMP ---
logging host 172.20.7.35
logging trap informational
snmp-server enable traps
snmp-server host 172.20.7.35 version 2c cisco
ip access-list standard ACL-SNMP
 permit host 172.20.7.35
 deny any
exit
snmp-server community cisco RO ACL-SNMP

! --- SSH RESTRICTION ---
ip access-list standard SSH-ACCESS
 permit 172.20.4.0 0.0.0.255
 permit 172.20.5.0 0.0.0.255
 deny any
line vty 0 15
 access-class SSH-ACCESS in
end
wr