! rt1-zg
enable
conf t
hostname RT1-Zg-777
service password-encryption
username cisco privilege 15 secret classclass
security passwords min-length 10
no ip domain-lookup
ip domain name isepacademy.ccna.itn.com
crypto key generate rsa general-keys modulus 2048
ip ssh version 2
login block-for 300 attempts 3 within 120
line con 0
password classclass
login local
line aux 0
password classclass
login
line vty 0 15
exec-timeout 0 30
login local
privilege level 15
transport input ssh
exit

banner motd %
######################################################################
#                                                                    #
#                        Private Property                            #
#            Unnauthorized access will not be tolerated              #
#                           RT1-Zg-777                               #
#                                                                    #
######################################################################
%

! --- INTERFACES LAN ---
interface GigabitEthernet0/0  
description CONNECTION TO MLS1-ZG  
ip address 172.20.7.97 255.255.255.252 
no shut
duplex auto  
speed auto  
ip nat inside
  
interface GigabitEthernet0/1  
description CONNECTION TO MLS2-ZG  
ip address 172.20.7.101 255.255.255.252  
no shut
duplex auto  
speed auto  
ip nat inside

! --- INTERFACE WAN (INTERNET) ---
interface GigabitEthernet0/2  
ip address dhcp
no shut  
duplex auto  
speed auto  
ip nat outside
exit

! --- NAT E ROUTING ---
access-list 1 permit 172.20.0.0 0.0.255.255
ip nat inside source list 1 interface GigabitEthernet0/2 overload

ip nat inside source static tcp 172.20.7.36 80 interface GigabitEthernet0/2 80
ip nat inside source static tcp 172.20.7.36 443 interface GigabitEthernet0/2 443
ip nat inside source static tcp 172.20.7.36 22 interface GigabitEthernet0/2 22

ip route 0.0.0.0 0.0.0.0 dhcp

! --- ACLS PARA VPN 
! Substituir IP_ZAGREB pelo IP da tua interface G0/2
! Substituir IP_PULA e IP_SPLIT pelos IPs remotos

ip access-list extended 101
 permit gre host IP_ZAGREB host IP_PULA
 deny ip any any

ip access-list extended 102
 permit gre host IP_ZAGREB host IP_SPLIT
 deny ip any any

! --- CONFIGURAÇÃO IPSEC ---
crypto isakmp policy 100
 encr aes 128
 hash sha
 authentication pre-share
 group 5
exit

! Chaves (Pre-Shared Keys)
crypto isakmp key z4gr3bPvl4 address IP_PULA
crypto isakmp key z4gr3b$pl1t address IP_SPLIT

! Transform Set
crypto ipsec transform-set TSET esp-aes 128 esp-sha-hmac
 mode tunnel
exit

! Crypto Maps
crypto map CROATIA 10 ipsec-isakmp 
 set peer IP_PULA
 set transform-set TSET
 match address 101
exit

crypto map CROATIA 20 ipsec-isakmp 
 set peer IP_SPLIT
 set transform-set TSET
 match address 102
exit

interface GigabitEthernet0/2
 crypto map CROATIA
exit

! --- TÚNEIS GRE ---
! Túnel para Pula
interface Tunnel0
 description Tunnel ZAGREB-PULA
 ip address 10.0.0.1 255.255.255.252
 tunnel source GigabitEthernet0/2
 tunnel destination IP_PULA

! Túnel para Split
interface Tunnel1
 description Tunnel ZAGREB-SPLIT
 ip address 10.0.0.5 255.255.255.252
 tunnel source GigabitEthernet0/2
 tunnel destination IP_SPLIT

! --- OSPF ---
conf t
router ospf 100
 router-id 1.1.1.1
 ! Redes de ligação aos MLS1 e MLS2
 network 172.20.7.96 0.0.0.3 area 0
 network 172.20.7.100 0.0.0.3 area 0
 ! Redes dos Túneis para Pula e Split
 network 10.0.0.0 0.0.0.3 area 0
 network 10.0.0.4 0.0.0.3 area 0
 ! Propagar a rota default (Internet) para as filiais
 default-information originate
 ! Segurança e Eficiência
 passive-interface default
 no passive-interface GigabitEthernet0/0
 no passive-interface GigabitEthernet0/1
 no passive-interface Tunnel0
 no passive-interface Tunnel1
exitend


! Ligação ao snmp
conf t

logging host 172.20.7.35
logging trap informational

snmp-server community cisco RO

snmp-server enable traps
snmp-server host 172.20.7.35 version 2c cisco
conf t

ip access-list standard ACL-SNMP
 permit host 172.20.7.35
 deny any
exit

snmp-server community cisco RO ACL-SNMP


! ACL para o acesso ssh - IMPORTANTE
conf t
ip access-list standard SSH-ACCESS
 permit 172.20.4.0 0.0.0.255
 permit 172.20.5.0 0.0.0.255
 deny any
line vty 0 15
 access-class SSH-ACCESS in

conf t
ntp server 209.165.200.225 ! < ntp srv ip - ver com o bruno, n diz no pdf >
ntp master 3


end


ip host rt1-zg 172.20.7.97
ip host mls1-zg 172.20.7.4
ip host mls2-zg 172.20.7.5
ip host sw1-zg 172.20.7.2
ip host sw2-zg 172.20.7.3
ip host srv-dhcp 172.20.7.36
ip host rt1-pl 172.20.11.105
ip host sw1-pl 172.20.11.106
ip host rt1-st 172.20.14.41
ip host sw1-st 172.20.14.42
ip host zagreb-pula 10.0.0.1
ip host pula-zagreb 10.0.0.2
ip host zagreb-split 10.0.0.5
ip host split-zagreb 10.0.0.6
ip host pula-split 10.0.0.9
ip host split-pula 10.0.0.10



conf t

! --- Phase 1: ISAKMP Policy ---
crypto isakmp policy 100
 encr aes 128
 hash sha
 authentication pre-share
 group 5
exit

! --- Keys (Pre-Shared) ---
! Chave para Pula
crypto isakmp key z4gr3bPvl4 address SUBSTITUIR_IP_WAN_PULA
! Chave para Split
crypto isakmp key z4gr3b$pl1t address SUBSTITUIR_IP_WAN_SPLIT

! --- Phase 2: Transform Set ---
crypto ipsec transform-set TSET esp-aes 128 esp-sha-hmac
 mode tunnel
exit

! --- ACLs para definir tráfego GRE ---
! ACL 101: De Zagreb para Pula
ip access-list extended 101
 permit gre host SUBSTITUIR_IP_WAN_ZAGREB host SUBSTITUIR_IP_WAN_PULA
! ACL 102: De Zagreb para Split
ip access-list extended 102
 permit gre host SUBSTITUIR_IP_WAN_ZAGREB host SUBSTITUIR_IP_WAN_SPLIT

! --- Crypto Map ---
crypto map CROATIA 10 ipsec-isakmp
 set peer SUBSTITUIR_IP_WAN_PULA
 set transform-set TSET
 match address 101
!
crypto map CROATIA 20 ipsec-isakmp
 set peer SUBSTITUIR_IP_WAN_SPLIT
 set transform-set TSET
 match address 102

! --- Aplicar na Interface WAN ---
interface GigabitEthernet0/2
 crypto map CROATIA
exit


conf t

! --- a. Standard ACL para permitir NAT de todas as redes ---
! Permite qualquer rede interna começada por 172.20.x.x
access-list 1 permit 172.20.0.0 0.0.255.255

! --- b. Regra de Dynamic NAT (Overload/PAT) ---
! Traduz o tráfego da ACL 1 para o IP da interface WAN (G0/2)
ip nat inside source list 1 interface GigabitEthernet0/2 overload

! --- d. Regras de Static NAT (Port Forwarding) ---
! [cite_start]Redireciona tráfego externo nas portas 80, 443 e 22 para o SRV-DHCP (172.20.7.36) [cite: 99]
ip nat inside source static tcp 172.20.7.36 80 interface GigabitEthernet0/2 80
ip nat inside source static tcp 172.20.7.36 443 interface GigabitEthernet0/2 443
ip nat inside source static tcp 172.20.7.36 22 interface GigabitEthernet0/2 22

! --- Definição das Interfaces (Inside/Outside) ---
! Interface WAN (Internet)
interface GigabitEthernet0/2
 ip nat outside
 exit

! Interfaces LAN (Ligação aos MLSs)
interface GigabitEthernet0/0
 ip nat inside
 exit
interface GigabitEthernet0/1
 ip nat inside
 exit


conf t
! O pool DHCP para a VLAN 40 já existe, garante que tem a Option 150 [cite: 101]
ip dhcp pool VLAN40-VOIP
 option 150 ip 172.20.0.10 [cite: 101]
exit

telephony-service
 max-ephones 10 [cite: 107]
 max-dn 20 [cite: 107]
 ip source-address 172.20.0.10 port 2000 [cite: 107]
 system message ZAGREB-VOICE [cite: 107]
 create cnf-files [cite: 107]
exit

! Configurar os números (Extensions)
ephone-dn 1
 number 2001 [cite: 107]
ephone-dn 2
 number 2002 [cite: 107]

 
wr
