! rt1-zg
enable
conf t
hostname RT1-Zg-777
service password-encryption
username cisco privilege 15 secret classclass
security passwords min-length 10
no ip domain-lookup
ip domain name isepacademy.ccna.itn.com
crypto key generate rsa general-keys modulus 2048
ip ssh version 2
login block-for 300 attempts 3 within 120
line con 0
password classclass
login local
line aux 0
password classclass
login
line vty 0 15
exec-timeout 0 30
login local
privilege level 15
transport input ssh
exit

banner motd %
######################################################################
#                                                                    #
#                        Private Property                            #
#            Unnauthorized access will not be tolerated              #
#                           RT1-Zg-777                               #
#                                                                    #
######################################################################
%

! --- INTERFACES LAN ---
interface GigabitEthernet0/0  
description CONNECTION TO MLS1-ZG  
ip address 172.20.7.97 255.255.255.252 
no shut
duplex auto  
speed auto  
ip nat inside
  
interface GigabitEthernet0/1  
description CONNECTION TO MLS2-ZG  
ip address 172.20.7.101 255.255.255.252  
no shut
duplex auto  
speed auto  
ip nat inside

! --- INTERFACE WAN (INTERNET) ---
interface GigabitEthernet0/2  
ip address dhcp
no shut  
duplex auto  
speed auto  
ip nat outside
exit

! --- NAT E ROUTING ---
access-list 1 permit 172.20.0.0 0.0.255.255
ip nat inside source list 1 interface GigabitEthernet0/2 overload

ip nat inside source static tcp 172.20.7.36 80 interface GigabitEthernet0/2 80
ip nat inside source static tcp 172.20.7.36 443 interface GigabitEthernet0/2 443
ip nat inside source static tcp 172.20.7.36 22 interface GigabitEthernet0/2 22

ip route 0.0.0.0 0.0.0.0 dhcp

! --- ACLS PARA VPN 
! Substituir IP_ZAGREB pelo IP da tua interface G0/2
! Substituir IP_PULA e IP_SPLIT pelos IPs remotos

ip access-list extended 101
 permit gre host IP_ZAGREB host IP_PULA
 deny ip any any

ip access-list extended 102
 permit gre host IP_ZAGREB host IP_SPLIT
 deny ip any any

! --- CONFIGURAÇÃO IPSEC ---
crypto isakmp policy 100
 encr aes 128
 hash sha
 authentication pre-share
 group 5
exit

! Chaves (Pre-Shared Keys)
crypto isakmp key z4gr3bPvl4 address IP_PULA
crypto isakmp key z4gr3b$pl1t address IP_SPLIT

! Transform Set
crypto ipsec transform-set TSET esp-aes 128 esp-sha-hmac
 mode tunnel
exit

! Crypto Maps
crypto map CROATIA 10 ipsec-isakmp 
 set peer IP_PULA
 set transform-set TSET
 match address 101
exit

crypto map CROATIA 20 ipsec-isakmp 
 set peer IP_SPLIT
 set transform-set TSET
 match address 102
exit

interface GigabitEthernet0/2
 crypto map CROATIA
exit

! --- TÚNEIS GRE ---
! Túnel para Pula
interface Tunnel0
 description Tunnel ZAGREB-PULA
 ip address 10.0.0.1 255.255.255.252
 tunnel source GigabitEthernet0/2
 tunnel destination IP_PULA

! Túnel para Split
interface Tunnel1
 description Tunnel ZAGREB-SPLIT
 ip address 10.0.0.5 255.255.255.252
 tunnel source GigabitEthernet0/2
 tunnel destination IP_SPLIT

! --- OSPF ---
router ospf 100
 router-id 1.1.1.1
 ! Redes Internas
 network 172.20.7.97 0.0.0.0 area 0
 network 172.20.7.101 0.0.0.0 area 0
 ! Redes dos Túneis
 network 10.0.0.0 0.0.0.3 area 0
 network 10.0.0.4 0.0.0.3 area 0
 ! Propagar Rota Default
 default-information originate
 ! Segurança
 passive-interface GigabitEthernet0/2
end


! Ligação ao snmp
conf t

logging host 172.20.7.35
logging trap informational

snmp-server community cisco RO

snmp-server enable traps
snmp-server host 172.20.7.35 version 2c cisco
conf t

ip access-list standard ACL-SNMP
 permit host 172.20.7.35
 deny any
exit

snmp-server community cisco RO ACL-SNMP


! ACL para o acesso ssh - IMPORTANTE
conf t
ip access-list standard SSH-ACCESS
 permit 172.20.4.0 0.0.0.255
 permit 172.20.5.0 0.0.0.255
 deny any
line vty 0 15
 access-class SSH-ACCESS in

conf t
ntp server 209.165.200.225 ! < ntp srv ip - ver com o bruno, n diz no pdf >
ntp master 3


end
wr
